
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation powered by MkDocs">
      
      
        <meta name="author" content="gchem1se">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>System messages - Reversing WhatsApp's SQLite</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../img/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#key-tables-and-relations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Reversing WhatsApp&#39;s SQLite" class="md-header__button md-logo" aria-label="Reversing WhatsApp's SQLite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Reversing WhatsApp's SQLite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              System messages
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Reversing WhatsApp&#39;s SQLite" class="md-nav__button md-logo" aria-label="Reversing WhatsApp's SQLite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Reversing WhatsApp's SQLite
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Getting started" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contacts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Contacts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Recovering contacts from wa.db" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recovering contacts from wa.db
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Recovering contacts from Google Contacts" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recovering contacts from Google Contacts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notes on databases encryption
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Notes on databases encryption
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../How to get your decryption key" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to get your decryption key
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Launching a backup manually" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launching a backup manually
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chats and Groups" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chats and Groups
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Messages
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Messages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Get messages from a conversation" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get messages from a conversation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Answers to messages" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Answers to messages
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Attachments
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Attachments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Media attachments" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Media attachments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other kinds of attachments
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Other kinds of attachments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Polls" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Polls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Locations" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Locations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../System messages" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System messages
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Recovering your sticker packs" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recovering your sticker packs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Statistics" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Queries" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Queries
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-tables-and-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Key tables and relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key tables and relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#auxiliary-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Auxiliary tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" class="md-nav__link">
    <span class="md-ellipsis">
      Query
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>System messages</h1>

<p>System messages are messages that you have not sent or received by any of your peers, but are instead sent to you by WhatsApp's system itself. More often than not these get rendered on the conversation itself, like for messages announcing someone joining or leaving a group, or you blocking a contact.<br />
The (rather annoying) alerts that notify you of the end-to-end encryption of your conversations at the very start of a new chat also fall in this category.</p>
<p><a class="glightbox" href="../img/Pasted%20image%2020241003200709.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Pasted image 20241003200709.png" class="center" src="../img/Pasted%20image%2020241003200709.png" /></a></p>
<p>This messages are still stored in the <code>message</code> table among all other interactions real users have, but you do find them also referenced in the <code>message_system</code> table, where the <em>type</em> of that messages gets specified. <br />
A bunch of additional tables in the database contribute to the complete characterization of these kind of "special" messages.</p>
<h2 id="key-tables-and-relations">Key tables and relations</h2>
<p><a class="glightbox" href="../img/Pasted%20image%2020241004024025.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Pasted image 20241004024025.png" class="center" src="../img/Pasted%20image%2020241004024025.png" /></a></p>
<ul>
<li><code>message_system</code>: a table of just two columns, which builds the relation between each system message and its type, here called <em>action type</em>.<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>action_type</code></li>
</ul>
</li>
<li><code>message</code>: contains all messages, including system's; useful here since some system messages do have text contents and that is stored only here. We know already that system messages have <code>type = 7</code> in this table <a href="../Get%20messages%20from%20a%20conversation/">from our previous analysis</a>.<ul>
<li>we don't need to filter for <code>type = 7</code> anyway, we can just user an inner join with <code>message_system</code>.</li>
<li>important columns for this query: <code>_id</code>, <code>text_data</code>, <code>timestamp</code>, <code>chat_row_id</code></li>
</ul>
</li>
<li><code>jid</code>: contains a unique string for each entity interacting in your WhatsApp system. We need this table to identify people (or entities) involved in the actions described in the system message (eg. <em>who</em> has left the group).<ul>
<li>important columns for this query: <code>_id</code>, <code>user</code></li>
</ul>
</li>
<li><code>message_system_chat_participant</code>: this table is used for all kind of messages involving a (former) group participant as an actor (eg. someone has left the group, someone has joined it). Only two columns linking the system message to the user.<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>user_jid_row_id</code></li>
</ul>
</li>
<li><code>message_system_number_change</code>: in the case of a system message announcing that a group participant <em>has changed its phone number</em>, this table would link that message to both the old and new <em>jid</em> (identifying string, stored in the <code>jid</code> table) of that user<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>old_jid_row_id</code>, <code>new_jid_row_id</code></li>
</ul>
</li>
<li><code>message_system_block_contact</code>: links messages announcing that you blocked or unblocked an user to the actual action you took<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>is_blocked</code></li>
</ul>
</li>
<li><code>message_system_value_change</code>: when someone changes the name/subject of a group, <em>or</em> you change the name of a contact of yours, a system message is created in the <code>messages</code> table and gets referenced in this table. This table stores the old value of the name that was displayed; <code>messages</code> stores the new value for it in its <code>text_data</code> column.<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>old_data</code></li>
</ul>
</li>
<li><code>message_system_photo_change</code>: this table's records actually store plain thumbnails (in JPG format) inside their columns, one for the picture the group used to have as its propic, and one for the newly set one.<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>old_photo</code>, <code>new_photo</code></li>
</ul>
</li>
<li><code>message_system_group</code>: each time someone (yourself included) joins a group (either via an invitation link or because an administrator puts them in) a new system message (respectively, with <code>action_type</code> equal to <code>4</code> or to <code>20</code>) gets created. This table makes it possible to know <em>if the one who joined was me or not</em>. It's just two columns.<ul>
<li>you could think about <em>not using this table at all</em> and recover this information (<em>was it me the one who joined the group or was it someone else?</em>) from a JOIN between <code>message_system_group_participant</code> and <code>jid</code>, checking if the jid of the one joining the group is your own. <ul>
<li>However, I found out that the <code>jid</code> table <em>does not store your own jid in any different way from any other user's</em>, so you would have to rely on other JOIN operations to get what your jid is. So it's better to just use the <code>message_system_group</code> table.</li>
</ul>
</li>
<li>important columns for this query: <code>message_row_id</code>, <code>is_me_joined</code></li>
</ul>
</li>
<li><code>message_ephemeral_setting</code> keeps track of the chat being set as <em>ephemeral</em> and of how many seconds the messages will be kept before disappearing. If that field is <code>0</code>, the ephemeral setting is been disabled.<ul>
<li>important columns for this query: <code>message_row_id</code>, <code>setting_duration</code></li>
</ul>
</li>
<li>joining with <code>AUX_conversation</code> (<a href="../Chats%20and%20Groups/">which we created here</a>) lets us filter these messages by chat.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Other tables</p>
<p>I am aware that these are not the only tables called <code>message_system_&lt;something&gt;</code> and therefore that even more information could technically be extracted. I just don't grasp the meaning of many of them still. Moreover, I find the list above to be quite exhaustive in helping specifying system messages.</p>
</div>
<h3 id="auxiliary-tables">Auxiliary tables</h3>
<p>Just as we did for other messages, we can simplify our queries by manually adding a static table to the database, containing only associations between the identifying integers for action types and their actual meaning.<br />
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">meaning</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_changed_subject&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_joined&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_left&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_changed_photo&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_changed_number&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_created_group&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_has_been_added&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_has_been_removed&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_you_became_administrator&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_someone_joined_via_invitation&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;group_changed_description&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;business_announcement&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;blocked_contact&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">59</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;ephemeral&quot;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">meaning</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">67</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;cryptography_init&quot;</span><span class="p">);</span>
</code></pre></div></p>
<hr />
<h2 id="query">Query</h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span>
<span class="w">        </span><span class="n">atype</span><span class="p">.</span><span class="n">meaning</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="ss">&quot;unknown: &quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">msys</span><span class="p">.</span><span class="n">action_type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">text</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">type</span><span class="p">,</span><span class="w">  </span>
<span class="w">    </span><span class="n">message</span><span class="p">.</span><span class="k">timestamp</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span>
<span class="w">    </span><span class="n">message</span><span class="p">.</span><span class="n">text_data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">text_contents</span><span class="p">,</span>
<span class="w">    </span><span class="n">msys_block</span><span class="p">.</span><span class="n">is_blocked</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_blocked</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">msys_value</span><span class="p">.</span><span class="n">old_data</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">        </span><span class="k">THEN</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="n">text_data</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_chat_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">msys_value</span><span class="p">.</span><span class="n">old_data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">old_chat_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">msys_group</span><span class="p">.</span><span class="n">is_me_joined</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_me_joined</span><span class="p">,</span>
<span class="w">    </span><span class="n">msys_ph</span><span class="p">.</span><span class="n">old_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">old_chat_propic</span><span class="p">,</span>
<span class="w">    </span><span class="n">msys_ph</span><span class="p">.</span><span class="n">new_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_chat_propic</span><span class="p">,</span>
<span class="w">    </span><span class="n">old_jid</span><span class="p">.</span><span class="k">user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">old_actor_phone</span><span class="p">,</span>
<span class="w">    </span><span class="n">new_jid</span><span class="p">.</span><span class="k">user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_actor_phone</span><span class="p">,</span>
<span class="w">    </span><span class="n">participant_jid</span><span class="p">.</span><span class="k">user</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">actor_phone</span><span class="p">,</span>
<span class="w">    </span><span class="n">meph</span><span class="p">.</span><span class="n">setting_duration</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ephemeral_duration</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">message_system</span><span class="w"> </span><span class="n">msys</span>

<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="n">_id</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">AUX_conversation</span><span class="w"> </span><span class="n">chat_info</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">chat_info</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="n">chat_row_id</span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">AUX_system_action_type</span><span class="w"> </span><span class="n">atype</span><span class="w"> </span><span class="c1">-- to account for missing ones</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">atype</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">action_type</span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_system_block_contact</span><span class="w"> </span><span class="n">msys_block</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_block</span><span class="p">.</span><span class="n">message_row_id</span><span class="w">  </span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_system_value_change</span><span class="w"> </span><span class="n">msys_value</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_block</span><span class="p">.</span><span class="n">message_row_id</span><span class="w">  </span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_system_group</span><span class="w"> </span><span class="n">msys_group</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_group</span><span class="p">.</span><span class="n">message_row_id</span><span class="w">  </span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_system_photo_change</span><span class="w"> </span><span class="n">msys_ph</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_ph</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_system_number_change</span><span class="w"> </span><span class="n">msys_phone</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_phone</span><span class="p">.</span><span class="n">message_row_id</span><span class="w">  </span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">jid</span><span class="w"> </span><span class="n">old_jid</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">old_jid</span><span class="p">.</span><span class="n">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_phone</span><span class="p">.</span><span class="n">old_jid_row_id</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">jid</span><span class="w"> </span><span class="n">new_jid</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">new_jid</span><span class="p">.</span><span class="n">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_phone</span><span class="p">.</span><span class="n">new_jid_row_id</span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_system_chat_participant</span><span class="w"> </span><span class="n">msys_cp</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_cp</span><span class="p">.</span><span class="n">message_row_id</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">jid</span><span class="w"> </span><span class="n">participant_jid</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">participant_jid</span><span class="p">.</span><span class="n">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msys_cp</span><span class="p">.</span><span class="n">user_jid_row_id</span>

<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">message_ephemeral_setting</span><span class="w"> </span><span class="n">meph</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">msys</span><span class="p">.</span><span class="n">message_row_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meph</span><span class="p">.</span><span class="n">message_row_id</span>

<span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="n">chat_info</span><span class="p">.</span><span class="n">displayed_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<hr />
<p>You should now have a full understanding of how things are stored in WhatsApp's SQLite, so you can go run your personal queries or start building your own viewer. <a href="https://github.com/gchem1se/rechat">I have created my own, check it out!</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="../img/custom.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": false, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>